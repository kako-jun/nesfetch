#!/usr/bin/env python3
"""
NES CHR-ROM生成ツール
8x8タイルのグラフィックスデータを生成
"""

import struct

# CHR-ROMは8KB（8192バイト）
CHR_SIZE = 8192
chr_data = bytearray(CHR_SIZE)

# 8x8フォントデータ（簡易版ASCIIフォント）
# 各文字は8バイト（8行 x 8ピクセル）で定義
font_data = {
    # 空白とシンボル
    0x00: [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00],  # 空白
    0x01: [0x3C, 0x42, 0x81, 0x81, 0x81, 0x81, 0x42, 0x3C],  # ボックス

    # A-Z (0x21-0x3A に配置)
    0x21: [0x18, 0x24, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x42],  # A
    0x22: [0x7C, 0x42, 0x42, 0x7C, 0x42, 0x42, 0x42, 0x7C],  # B
    0x23: [0x3C, 0x42, 0x80, 0x80, 0x80, 0x80, 0x42, 0x3C],  # C
    0x24: [0x78, 0x44, 0x42, 0x42, 0x42, 0x42, 0x44, 0x78],  # D
    0x25: [0x7E, 0x40, 0x40, 0x7C, 0x40, 0x40, 0x40, 0x7E],  # E
    0x26: [0x7E, 0x40, 0x40, 0x7C, 0x40, 0x40, 0x40, 0x40],  # F
    0x27: [0x3C, 0x42, 0x80, 0x80, 0x8E, 0x82, 0x42, 0x3C],  # G
    0x28: [0x42, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x42, 0x42],  # H
    0x29: [0x3E, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x3E],  # I
    0x2A: [0x1F, 0x04, 0x04, 0x04, 0x04, 0x44, 0x44, 0x38],  # J
    0x2B: [0x42, 0x44, 0x48, 0x70, 0x48, 0x44, 0x42, 0x42],  # K
    0x2C: [0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x7E],  # L
    0x2D: [0x82, 0xC6, 0xAA, 0x92, 0x82, 0x82, 0x82, 0x82],  # M
    0x2E: [0x42, 0x62, 0x52, 0x4A, 0x46, 0x42, 0x42, 0x42],  # N
    0x2F: [0x3C, 0x42, 0x81, 0x81, 0x81, 0x81, 0x42, 0x3C],  # O
    0x30: [0x7C, 0x42, 0x42, 0x42, 0x7C, 0x40, 0x40, 0x40],  # P
    0x31: [0x3C, 0x42, 0x81, 0x81, 0x81, 0x8A, 0x44, 0x3A],  # Q
    0x32: [0x7C, 0x42, 0x42, 0x42, 0x7C, 0x48, 0x44, 0x42],  # R
    0x33: [0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x42, 0x3C],  # S
    0x34: [0xFE, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10],  # T
    0x35: [0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3C],  # U
    0x36: [0x82, 0x82, 0x44, 0x44, 0x28, 0x28, 0x10, 0x10],  # V
    0x37: [0x82, 0x82, 0x82, 0x82, 0x92, 0xAA, 0xC6, 0x82],  # W
    0x38: [0x42, 0x42, 0x24, 0x18, 0x18, 0x24, 0x42, 0x42],  # X
    0x39: [0x82, 0x44, 0x28, 0x10, 0x10, 0x10, 0x10, 0x10],  # Y
    0x3A: [0x7E, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x7E],  # Z

    # 数字 0-9
    0x10: [0x3C, 0x46, 0x8A, 0x92, 0xA2, 0xC2, 0x42, 0x3C],  # 0
    0x11: [0x10, 0x30, 0x10, 0x10, 0x10, 0x10, 0x10, 0x38],  # 1
    0x12: [0x3C, 0x42, 0x02, 0x0C, 0x30, 0x40, 0x40, 0x7E],  # 2
    0x13: [0x3C, 0x42, 0x02, 0x1C, 0x02, 0x02, 0x42, 0x3C],  # 3
    0x14: [0x04, 0x0C, 0x14, 0x24, 0x44, 0x7E, 0x04, 0x04],  # 4
    0x15: [0x7E, 0x40, 0x40, 0x7C, 0x02, 0x02, 0x42, 0x3C],  # 5
    0x16: [0x1C, 0x20, 0x40, 0x7C, 0x42, 0x42, 0x42, 0x3C],  # 6
    0x17: [0x7E, 0x02, 0x04, 0x08, 0x10, 0x10, 0x10, 0x10],  # 7
    0x18: [0x3C, 0x42, 0x42, 0x3C, 0x42, 0x42, 0x42, 0x3C],  # 8
    0x19: [0x3C, 0x42, 0x42, 0x42, 0x3E, 0x02, 0x04, 0x38],  # 9

    # 記号
    0x3B: [0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x18, 0x18],  # :
    0x3C: [0x00, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x00, 0x00],  # -
    0x3D: [0x00, 0x08, 0x1C, 0x3E, 0x1C, 0x08, 0x00, 0x00],  # >
    0x3E: [0x00, 0x10, 0x38, 0x7C, 0x38, 0x10, 0x00, 0x00],  # <
    0x3F: [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00],  # スペース
}

# Linuxペンギン（Tux）風のドット絵
linux_logo = {
    # タイル0x40-0x4F (4x4タイル = 32x32ピクセル)
    0x40: [0x00, 0x00, 0x18, 0x24, 0x24, 0x18, 0x00, 0x00],
    0x41: [0x00, 0x00, 0x18, 0x24, 0x24, 0x18, 0x00, 0x00],
    0x42: [0x00, 0x18, 0x24, 0x42, 0x42, 0x42, 0x24, 0x00],
    0x43: [0x00, 0x18, 0x24, 0x42, 0x42, 0x42, 0x24, 0x00],
    0x44: [0x00, 0x24, 0x42, 0x7E, 0x42, 0x42, 0x42, 0x00],
    0x45: [0x00, 0x24, 0x42, 0x7E, 0x42, 0x42, 0x42, 0x00],
    0x46: [0x00, 0x42, 0x42, 0x42, 0x42, 0x24, 0x18, 0x00],
    0x47: [0x00, 0x42, 0x42, 0x42, 0x42, 0x24, 0x18, 0x00],
    0x48: [0x00, 0x3C, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00],
    0x49: [0x00, 0x3C, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00],
    0x4A: [0x00, 0x42, 0x42, 0x24, 0x18, 0x18, 0x18, 0x00],
    0x4B: [0x00, 0x42, 0x42, 0x24, 0x18, 0x18, 0x18, 0x00],
}

# PlayStation風ロゴ
playstation_logo = {
    0x50: [0x7C, 0x42, 0x42, 0x7C, 0x40, 0x40, 0x40, 0x40],  # P
    0x51: [0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x42, 0x3C],  # S
    0x52: [0xFF, 0x81, 0x81, 0x81, 0x81, 0x81, 0x81, 0xFF],  # ボックス
    0x53: [0x00, 0x7E, 0x42, 0x42, 0x42, 0x42, 0x7E, 0x00],  # ○
    0x54: [0x00, 0x42, 0x24, 0x18, 0x18, 0x24, 0x42, 0x00],  # ×
    0x55: [0x00, 0x18, 0x3C, 0x7E, 0x7E, 0x3C, 0x18, 0x00],  # ◆
    0x56: [0x00, 0x3C, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00],  # □
}

# Apple風ロゴ
apple_logo = {
    0x60: [0x00, 0x18, 0x18, 0x00, 0x3C, 0x42, 0x42, 0x42],  # リンゴ上部
    0x61: [0x42, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x42, 0x00],  # リンゴ下部
    0x62: [0x00, 0x7E, 0x40, 0x7C, 0x40, 0x40, 0x7E, 0x00],  # 葉っぱ
}

# Windows風ロゴ
windows_logo = {
    0x70: [0x7F, 0x7F, 0x7F, 0x7F, 0x00, 0x00, 0x00, 0x00],  # 左上
    0x71: [0xFE, 0xFE, 0xFE, 0xFE, 0x00, 0x00, 0x00, 0x00],  # 右上
    0x72: [0x00, 0x00, 0x00, 0x00, 0x7F, 0x7F, 0x7F, 0x7F],  # 左下
    0x73: [0x00, 0x00, 0x00, 0x00, 0xFE, 0xFE, 0xFE, 0xFE],  # 右下
}

# NESコントローラー風ロゴ
nes_logo = {
    0x80: [0xFF, 0x81, 0x81, 0x81, 0x81, 0x81, 0x81, 0xFF],  # コントローラー外枠
    0x81: [0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00],  # 十字キー縦
    0x82: [0x00, 0x00, 0x7E, 0x7E, 0x7E, 0x00, 0x00, 0x00],  # 十字キー横
    0x83: [0x00, 0x3C, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00],  # Aボタン
    0x84: [0x00, 0x3C, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00],  # Bボタン
}


def write_tile(tile_index, pattern):
    """
    8x8タイルデータをCHR-ROMに書き込む
    NESのタイルフォーマット：16バイト/タイル
    - 最初の8バイト: bit plane 0
    - 次の8バイト: bit plane 1
    """
    offset = tile_index * 16

    for i in range(8):
        # bit plane 0 (下位ビット)
        chr_data[offset + i] = pattern[i]
        # bit plane 1 (上位ビット) - とりあえず0
        chr_data[offset + 8 + i] = 0x00


def main():
    # フォントデータを書き込み
    for tile_id, pattern in font_data.items():
        write_tile(tile_id, pattern)

    # ロゴデータを書き込み
    all_logos = [linux_logo, playstation_logo, apple_logo, windows_logo, nes_logo]
    for logo in all_logos:
        for tile_id, pattern in logo.items():
            write_tile(tile_id, pattern)

    # CHR-ROMファイルを出力
    with open('chr.bin', 'wb') as f:
        f.write(chr_data)

    print(f"CHR-ROM created: chr.bin ({len(chr_data)} bytes)")


if __name__ == '__main__':
    main()
