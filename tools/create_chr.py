#!/usr/bin/env python3
"""
NES CHR-ROM生成ツール
8x8タイルのグラフィックスデータを生成
"""

import struct

# CHR-ROMは8KB（8192バイト）
CHR_SIZE = 8192
chr_data = bytearray(CHR_SIZE)

# 8x8フォントデータ（簡易版ASCIIフォント）
# 各文字は8バイト（8行 x 8ピクセル）で定義
font_data = {
    # 空白とシンボル
    0x00: [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00],  # 空白
    0x01: [0x3C, 0x42, 0x81, 0x81, 0x81, 0x81, 0x42, 0x3C],  # ボックス

    # A-Z (0x21-0x3A に配置)
    0x21: [0x18, 0x24, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x42],  # A
    0x22: [0x7C, 0x42, 0x42, 0x7C, 0x42, 0x42, 0x42, 0x7C],  # B
    0x23: [0x3C, 0x42, 0x80, 0x80, 0x80, 0x80, 0x42, 0x3C],  # C
    0x24: [0x78, 0x44, 0x42, 0x42, 0x42, 0x42, 0x44, 0x78],  # D
    0x25: [0x7E, 0x40, 0x40, 0x7C, 0x40, 0x40, 0x40, 0x7E],  # E
    0x26: [0x7E, 0x40, 0x40, 0x7C, 0x40, 0x40, 0x40, 0x40],  # F
    0x27: [0x3C, 0x42, 0x80, 0x80, 0x8E, 0x82, 0x42, 0x3C],  # G
    0x28: [0x42, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x42, 0x42],  # H
    0x29: [0x3E, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x3E],  # I
    0x2A: [0x1F, 0x04, 0x04, 0x04, 0x04, 0x44, 0x44, 0x38],  # J
    0x2B: [0x42, 0x44, 0x48, 0x70, 0x48, 0x44, 0x42, 0x42],  # K
    0x2C: [0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x7E],  # L
    0x2D: [0x82, 0xC6, 0xAA, 0x92, 0x82, 0x82, 0x82, 0x82],  # M
    0x2E: [0x42, 0x62, 0x52, 0x4A, 0x46, 0x42, 0x42, 0x42],  # N
    0x2F: [0x3C, 0x42, 0x81, 0x81, 0x81, 0x81, 0x42, 0x3C],  # O
    0x30: [0x7C, 0x42, 0x42, 0x42, 0x7C, 0x40, 0x40, 0x40],  # P
    0x31: [0x3C, 0x42, 0x81, 0x81, 0x81, 0x8A, 0x44, 0x3A],  # Q
    0x32: [0x7C, 0x42, 0x42, 0x42, 0x7C, 0x48, 0x44, 0x42],  # R
    0x33: [0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x42, 0x3C],  # S
    0x34: [0xFE, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10],  # T
    0x35: [0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3C],  # U
    0x36: [0x82, 0x82, 0x44, 0x44, 0x28, 0x28, 0x10, 0x10],  # V
    0x37: [0x82, 0x82, 0x82, 0x82, 0x92, 0xAA, 0xC6, 0x82],  # W
    0x38: [0x42, 0x42, 0x24, 0x18, 0x18, 0x24, 0x42, 0x42],  # X
    0x39: [0x82, 0x44, 0x28, 0x10, 0x10, 0x10, 0x10, 0x10],  # Y
    0x3A: [0x7E, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x7E],  # Z

    # 数字 0-9
    0x10: [0x3C, 0x46, 0x8A, 0x92, 0xA2, 0xC2, 0x42, 0x3C],  # 0
    0x11: [0x10, 0x30, 0x10, 0x10, 0x10, 0x10, 0x10, 0x38],  # 1
    0x12: [0x3C, 0x42, 0x02, 0x0C, 0x30, 0x40, 0x40, 0x7E],  # 2
    0x13: [0x3C, 0x42, 0x02, 0x1C, 0x02, 0x02, 0x42, 0x3C],  # 3
    0x14: [0x04, 0x0C, 0x14, 0x24, 0x44, 0x7E, 0x04, 0x04],  # 4
    0x15: [0x7E, 0x40, 0x40, 0x7C, 0x02, 0x02, 0x42, 0x3C],  # 5
    0x16: [0x1C, 0x20, 0x40, 0x7C, 0x42, 0x42, 0x42, 0x3C],  # 6
    0x17: [0x7E, 0x02, 0x04, 0x08, 0x10, 0x10, 0x10, 0x10],  # 7
    0x18: [0x3C, 0x42, 0x42, 0x3C, 0x42, 0x42, 0x42, 0x3C],  # 8
    0x19: [0x3C, 0x42, 0x42, 0x42, 0x3E, 0x02, 0x04, 0x38],  # 9

    # 記号
    0x3B: [0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x18, 0x18],  # :
    0x3C: [0x00, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x00, 0x00],  # -
    0x3D: [0x00, 0x08, 0x1C, 0x3E, 0x1C, 0x08, 0x00, 0x00],  # >
    0x3E: [0x00, 0x10, 0x38, 0x7C, 0x38, 0x10, 0x00, 0x00],  # <
    0x3F: [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00],  # スペース
}

# 各ゲーム機のロゴタイルデータ（各ロゴ4タイル）
# タイルは0x40からstart、各ロゴは4タイルずつ連続配置
logos = [
    # 0: NES
    [[0xFF, 0x81, 0x81, 0x99, 0x99, 0x81, 0x81, 0xFF],
     [0x18, 0x24, 0x42, 0x42, 0x42, 0x42, 0x24, 0x18],
     [0x3C, 0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3C],
     [0x7E, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x42, 0x7E]],
    # 1: SNES
    [[0xFE, 0x82, 0x82, 0x82, 0xFE, 0x80, 0x80, 0x80],
     [0x3C, 0x42, 0x80, 0x80, 0x80, 0x42, 0x3C, 0x00],
     [0xFF, 0x81, 0x99, 0xBD, 0xBD, 0x99, 0x81, 0xFF],
     [0x42, 0x42, 0x24, 0x18, 0x18, 0x24, 0x42, 0x42]],
    # 2: N64
    [[0x42, 0x62, 0x52, 0x4A, 0x46, 0x42, 0x42, 0x00],
     [0x18, 0x24, 0x24, 0x24, 0x24, 0x24, 0x18, 0x00],
     [0x3C, 0x42, 0x02, 0x1C, 0x20, 0x40, 0x7E, 0x00],
     [0x00, 0x18, 0x24, 0x42, 0x7E, 0x42, 0x42, 0x00]],
    # 3: GameCube
    [[0x3C, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00],
     [0x18, 0x24, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x00],
     [0x7C, 0x42, 0x42, 0x7C, 0x42, 0x42, 0x7C, 0x00],
     [0x3C, 0x42, 0x80, 0x80, 0x80, 0x42, 0x3C, 0x00]],
    # 4: Wii
    [[0x82, 0x44, 0x28, 0x10, 0x28, 0x44, 0x82, 0x00],
     [0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00],
     [0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00],
     [0x7E, 0x42, 0x42, 0x42, 0x42, 0x42, 0x7E, 0x00]],
    # 5: Wii U
    [[0x82, 0x44, 0x28, 0x10, 0x28, 0x44, 0x82, 0x00],
     [0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00],
     [0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00],
     [0xFF, 0x81, 0xBD, 0xBD, 0xBD, 0x81, 0xFF, 0x00]],
    # 6: Switch
    [[0x3C, 0x42, 0x81, 0x81, 0x81, 0x42, 0x3C, 0x00],
     [0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00],
     [0x3C, 0x42, 0x81, 0x81, 0x81, 0x42, 0x3C, 0x00],
     [0xFF, 0x81, 0x99, 0xBD, 0xBD, 0x99, 0x81, 0xFF]],
    # 7: Game Boy
    [[0xFF, 0x81, 0x81, 0xBD, 0xBD, 0x81, 0x81, 0xFF],
     [0x00, 0x3C, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00],
     [0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00],
     [0x00, 0x7E, 0x40, 0x40, 0x7C, 0x40, 0x7E, 0x00]],
    # 8: GBA
    [[0x7E, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x42, 0x00],
     [0x18, 0x24, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x00],
     [0x3C, 0x42, 0x80, 0x80, 0x80, 0x42, 0x3C, 0x00],
     [0x00, 0x3C, 0x42, 0x5A, 0x5A, 0x42, 0x3C, 0x00]],
    # 9: NDS
    [[0x42, 0x62, 0x52, 0x4A, 0x46, 0x42, 0x42, 0x00],
     [0x3C, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00],
     [0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x7E, 0x00],
     [0xFF, 0x81, 0x81, 0x81, 0x81, 0x81, 0xFF, 0x00]],
    # 10: 3DS
    [[0x3C, 0x42, 0x02, 0x1C, 0x02, 0x42, 0x3C, 0x00],
     [0x3C, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00],
     [0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x7E, 0x00],
     [0xFF, 0x81, 0x99, 0xA5, 0xA5, 0x99, 0x81, 0xFF]],
    # 11: PS1
    [[0x7C, 0x42, 0x42, 0x7C, 0x40, 0x40, 0x40, 0x00],
     [0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x42, 0x3C],
     [0x00, 0x7E, 0x42, 0x42, 0x42, 0x42, 0x7E, 0x00],
     [0x00, 0x42, 0x24, 0x18, 0x18, 0x24, 0x42, 0x00]],
    # 12: PS2
    [[0x7C, 0x42, 0x42, 0x7C, 0x40, 0x40, 0x40, 0x00],
     [0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x42, 0x3C],
     [0x3C, 0x42, 0x02, 0x1C, 0x02, 0x02, 0x42, 0x3C],
     [0x00, 0x3C, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00]],
    # 13: PS3
    [[0x7C, 0x42, 0x42, 0x7C, 0x40, 0x40, 0x40, 0x00],
     [0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x42, 0x3C],
     [0x3C, 0x42, 0x02, 0x1C, 0x02, 0x42, 0x3C, 0x00],
     [0x00, 0x18, 0x3C, 0x7E, 0x7E, 0x3C, 0x18, 0x00]],
    # 14: PS4
    [[0x7C, 0x42, 0x42, 0x7C, 0x40, 0x40, 0x40, 0x00],
     [0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x42, 0x3C],
     [0x04, 0x0C, 0x14, 0x24, 0x7E, 0x04, 0x04, 0x00],
     [0xFF, 0x81, 0x99, 0xBD, 0xBD, 0x99, 0x81, 0xFF]],
    # 15: PS5
    [[0x7C, 0x42, 0x42, 0x7C, 0x40, 0x40, 0x40, 0x00],
     [0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x42, 0x3C],
     [0x3E, 0x40, 0x40, 0x3C, 0x02, 0x02, 0x7C, 0x00],
     [0x00, 0x18, 0x3C, 0x7E, 0x7E, 0x3C, 0x18, 0x00]],
    # 16: PS Vita
    [[0x7C, 0x42, 0x42, 0x7C, 0x40, 0x40, 0x40, 0x00],
     [0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x42, 0x3C],
     [0x42, 0x42, 0x42, 0x42, 0x42, 0x24, 0x18, 0x00],
     [0xFF, 0x81, 0xBD, 0xA5, 0xA5, 0xBD, 0x81, 0xFF]],
    # 17: Genesis
    [[0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x42, 0x3C],
     [0x7E, 0x40, 0x40, 0x7C, 0x40, 0x40, 0x7E, 0x00],
     [0x3C, 0x42, 0x80, 0x8E, 0x82, 0x42, 0x3C, 0x00],
     [0x18, 0x24, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x00]],
    # 18: Saturn
    [[0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x42, 0x3C],
     [0x18, 0x24, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x00],
     [0xFE, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x00],
     [0x3C, 0x42, 0x81, 0x81, 0x81, 0x42, 0x3C, 0x00]],
    # 19: Dreamcast
    [[0x3C, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00],
     [0x00, 0x18, 0x3C, 0x7E, 0x7E, 0x3C, 0x18, 0x00],
     [0xFF, 0x81, 0xBD, 0xA5, 0xA5, 0xBD, 0x81, 0xFF],
     [0x42, 0x42, 0x24, 0x18, 0x18, 0x24, 0x42, 0x42]],
    # 20: Xbox
    [[0x42, 0x42, 0x24, 0x18, 0x18, 0x24, 0x42, 0x42],
     [0x3C, 0x42, 0x81, 0x81, 0x81, 0x42, 0x3C, 0x00],
     [0x00, 0x18, 0x3C, 0x7E, 0x7E, 0x3C, 0x18, 0x00],
     [0xFF, 0x81, 0x81, 0x81, 0x81, 0x81, 0xFF, 0x00]],
    # 21: Xbox 360
    [[0x42, 0x42, 0x24, 0x18, 0x18, 0x24, 0x42, 0x42],
     [0x3C, 0x42, 0x81, 0x81, 0x81, 0x42, 0x3C, 0x00],
     [0x3C, 0x42, 0x02, 0x1C, 0x02, 0x02, 0x42, 0x3C],
     [0x18, 0x24, 0x24, 0x24, 0x24, 0x24, 0x18, 0x00]],
    # 22: Xbox One
    [[0x42, 0x42, 0x24, 0x18, 0x18, 0x24, 0x42, 0x42],
     [0x3C, 0x42, 0x81, 0x81, 0x81, 0x42, 0x3C, 0x00],
     [0x3C, 0x42, 0x81, 0x81, 0x81, 0x42, 0x3C, 0x00],
     [0x00, 0x3C, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00]],
    # 23: Xbox Series X/S
    [[0x42, 0x42, 0x24, 0x18, 0x18, 0x24, 0x42, 0x42],
     [0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x42, 0x3C],
     [0x42, 0x42, 0x24, 0x18, 0x18, 0x24, 0x42, 0x42],
     [0xFF, 0x81, 0x99, 0xBD, 0xBD, 0x99, 0x81, 0xFF]],
    # 24: Atari
    [[0x18, 0x24, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x00],
     [0xFE, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x00],
     [0x18, 0x24, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x00],
     [0xFF, 0x81, 0x81, 0xBD, 0xBD, 0x81, 0x81, 0xFF]],
    # 25: PC Engine
    [[0x7C, 0x42, 0x42, 0x7C, 0x40, 0x40, 0x40, 0x00],
     [0x3C, 0x42, 0x80, 0x80, 0x80, 0x42, 0x3C, 0x00],
     [0x7E, 0x40, 0x40, 0x7C, 0x40, 0x40, 0x7E, 0x00],
     [0xFF, 0x81, 0x81, 0x81, 0x81, 0x81, 0xFF, 0x00]],
    # 26: Neo Geo
    [[0x42, 0x62, 0x52, 0x4A, 0x46, 0x42, 0x42, 0x00],
     [0x7E, 0x40, 0x40, 0x7C, 0x40, 0x40, 0x7E, 0x00],
     [0x3C, 0x42, 0x81, 0x81, 0x81, 0x42, 0x3C, 0x00],
     [0xFF, 0x81, 0x99, 0xBD, 0xBD, 0x99, 0x81, 0xFF]],
    # 27: Steam Deck
    [[0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x42, 0x3C],
     [0xFE, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x00],
     [0x7E, 0x40, 0x40, 0x7C, 0x40, 0x40, 0x7E, 0x00],
     [0xFF, 0x81, 0x99, 0xBD, 0xBD, 0x99, 0x81, 0xFF]],
    # 28: WonderSwan
    [[0x82, 0x82, 0x82, 0x92, 0xAA, 0xC6, 0x82, 0x00],
     [0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x42, 0x3C],
     [0x82, 0x44, 0x28, 0x10, 0x28, 0x44, 0x82, 0x00],
     [0xFF, 0x81, 0xBD, 0xA5, 0xA5, 0xBD, 0x81, 0xFF]],
]


def write_tile(tile_index, pattern):
    """
    8x8タイルデータをCHR-ROMに書き込む
    NESのタイルフォーマット：16バイト/タイル
    - 最初の8バイト: bit plane 0
    - 次の8バイト: bit plane 1
    """
    offset = tile_index * 16

    for i in range(8):
        # bit plane 0 (下位ビット)
        chr_data[offset + i] = pattern[i]
        # bit plane 1 (上位ビット) - とりあえず0
        chr_data[offset + 8 + i] = 0x00


def main():
    # フォントデータを書き込み
    for tile_id, pattern in font_data.items():
        write_tile(tile_id, pattern)

    # ゲーム機ロゴデータを書き込み
    # 各ロゴは0x40から開始、4タイルずつ連続配置
    for logo_idx, logo_tiles in enumerate(logos):
        base_tile = 0x40 + (logo_idx << 2)  # logo_idx * 4
        for tile_offset, pattern in enumerate(logo_tiles):
            write_tile(base_tile + tile_offset, pattern)

    # CHR-ROMファイルを出力
    with open('chr.bin', 'wb') as f:
        f.write(chr_data)

    print(f"CHR-ROM created: chr.bin ({len(chr_data)} bytes)")
    print(f"Total logos: {len(logos)}")


if __name__ == '__main__':
    main()
